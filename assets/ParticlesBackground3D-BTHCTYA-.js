import{j as u}from"./ui-B98_A1Av.js";import{r as e}from"./vendor-CssYUxOp.js";import{d as P,_ as p,e as v,c as x,D as f,f as w,V as j,C as U}from"./extends-qCVrm9OD.js";function R(n){return function(r){n.forEach(function(t){typeof t=="function"?t(r):t!=null&&(t.current=r)})}}const F=()=>parseInt(P.replace(/\D+/g,"")),S=F(),h=S>=154?"opaque_fragment":"output_fragment";class C extends v{constructor(r){super(r),this.onBeforeCompile=(t,a)=>{const{isWebGL2:i}=a.capabilities;t.fragmentShader=t.fragmentShader.replace(`#include <${h}>`,`
        ${i?`#include <${h}>`:`#extension GL_OES_standard_derivatives : enable
#include <${h}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${S>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const D=e.forwardRef((n,r)=>{const[t]=e.useState(()=>new C(null));return e.createElement("primitive",p({},n,{object:t,ref:r,attach:"material"}))});let c,d;const W=e.createContext(null),A=new w,_=new j,k=e.forwardRef(({children:n,range:r,limit:t=1e3,...a},i)=>{const o=e.useRef(null),[l,m]=e.useState([]),[[s,g,b]]=e.useState(()=>[new Float32Array(t*3),Float32Array.from({length:t*3},()=>1),Float32Array.from({length:t},()=>1)]);e.useEffect(()=>{o.current.geometry.attributes.position.needsUpdate=!0}),x(()=>{for(o.current.updateMatrix(),o.current.updateMatrixWorld(),A.copy(o.current.matrixWorld).invert(),o.current.geometry.drawRange.count=Math.min(t,r!==void 0?r:t,l.length),c=0;c<l.length;c++)d=l[c].current,d.getWorldPosition(_).applyMatrix4(A),_.toArray(s,c*3),o.current.geometry.attributes.position.needsUpdate=!0,d.matrixWorldNeedsUpdate=!0,d.color.toArray(g,c*3),o.current.geometry.attributes.color.needsUpdate=!0,b.set([d.size],c),o.current.geometry.attributes.size.needsUpdate=!0});const z=e.useMemo(()=>({getParent:()=>o,subscribe:E=>(m(y=>[...y,E]),()=>m(y=>y.filter(M=>M.current!==E.current)))}),[]);return e.createElement("points",p({userData:{instances:l},matrixAutoUpdate:!1,ref:R([i,o]),raycast:()=>null},a),e.createElement("bufferGeometry",null,e.createElement("bufferAttribute",{attach:"attributes-position",count:s.length/3,array:s,itemSize:3,usage:f}),e.createElement("bufferAttribute",{attach:"attributes-color",count:g.length/3,array:g,itemSize:3,usage:f}),e.createElement("bufferAttribute",{attach:"attributes-size",count:b.length,array:b,itemSize:1,usage:f})),e.createElement(W.Provider,{value:z},n))}),G=e.forwardRef(({children:n,positions:r,colors:t,sizes:a,stride:i=3,...o},l)=>{const m=e.useRef(null);return x(()=>{const s=m.current.geometry.attributes;s.position.needsUpdate=!0,t&&(s.color.needsUpdate=!0),a&&(s.size.needsUpdate=!0)}),e.createElement("points",p({ref:R([l,m])},o),e.createElement("bufferGeometry",null,e.createElement("bufferAttribute",{attach:"attributes-position",count:r.length/i,array:r,itemSize:i,usage:f}),t&&e.createElement("bufferAttribute",{attach:"attributes-color",count:t.length/i,array:t,itemSize:3,usage:f}),a&&e.createElement("bufferAttribute",{attach:"attributes-size",count:a.length/i,array:a,itemSize:1,usage:f})),n)}),I=e.forwardRef((n,r)=>n.positions instanceof Float32Array?e.createElement(G,p({},n,{ref:r})):e.createElement(k,p({},n,{ref:r})));function $({count:n=2e3}){const r=e.useRef(null),t=new Float32Array(n*3);for(let a=0;a<n;a++)t[a*3]=(Math.random()-.5)*10,t[a*3+1]=(Math.random()-.5)*10,t[a*3+2]=(Math.random()-.5)*10;return x(a=>{r.current&&(r.current.rotation.x=a.clock.getElapsedTime()*.05,r.current.rotation.y=a.clock.getElapsedTime()*.03)}),u.jsxs(I,{ref:r,limit:1500,children:[u.jsx("bufferGeometry",{children:u.jsx("bufferAttribute",{attach:"attributes-position",array:t,count:n,itemSize:3})}),u.jsx(D,{transparent:!0,color:"#3b82f6",size:.03,sizeAttenuation:!0,depthWrite:!1})]})}const q=()=>u.jsx("div",{className:"fixed inset-0 -z-10 opacity-50",children:u.jsx(U,{camera:{position:[0,0,5],fov:60},children:u.jsx($,{count:1500})})});export{q as default};
